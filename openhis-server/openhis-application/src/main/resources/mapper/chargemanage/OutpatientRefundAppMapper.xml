<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.openhis.web.chargemanage.mapper.OutpatientRefundAppMapper">

    <select id="selectEncounterPatientPayment"
            resultType="com.openhis.web.chargemanage.dto.EncounterPatientPaymentDto">
        SELECT T1.id,
               T1.status_enum,
               T1.relation_id,
               T1.payment_no,
               T1.payment_enum,
               T1.location_id,
               T1.expiration_date,
               T1.tendered_amount,
               T1.returned_amount,
               T1.contract_no,
               T1.charge_item_ids,
               T2.prescription_no,
               T2.account_id
        FROM fin_payment_reconciliation AS T1
            LEFT JOIN adm_charge_item AS T2
                ON T2.id IN (T1.charge_item_ids)
        WHERE T1.encouter_id =#{encounterId}
            AND T1.status_enum IN (#{success},#{refundAll},#{refundPart})
            AND T1.delete_flag = '0'
    </select>
</mapper>